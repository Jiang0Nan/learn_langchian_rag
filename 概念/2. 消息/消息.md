## 消息 messages
1. 什么是消息  
消息是聊天模型中的通信单位。它们用于表示聊天模型的输入和输出，以及可能与对话关联的任何其他上下文或元数据。
2. 消息的构成  
**角色**（role）: “用户”、“助手”  
**内容**(content)：消息的内容（例如，文本、多模态数据）。  
**其他元数据**：id、名称、 令牌使用情况和其他特定于模型的元数据。
3. 角色 (role) 

|   角色 (role)   |                            描述(description)                            | 案例  |
|:-------------:|:---------------------------------------------------------------------:|:---:|
|    system     |                 用于告诉聊天模型如何行为并提供其他上下文。并非所有聊天模型提供程序都支持。                 |SystemMessage(content="你是一名全科医学专家，回答必须专业、简洁。")|
|     user      |                     表示用户与模型交互的输入，通常以文本或其他交互式输入的形式                     |HumanMessage(content="患者，男性，45岁，最近出现胸闷和咳嗽，请问可能是什么问题？")|
| assistant(AI) |                          模型的回复，用于返回文本或结构化信息。                          |AIMessage(content="根据症状，可能是心血管问题或呼吸系统感染。建议进一步检查心电图和胸片。")|
|     tool      |   表示调用外部工具或 API 的结果返回。                                                |                                             |

4. 内容（content）  
**SystemMessage** -- 用于启动 AI 模型的行为并提供额外的上下文，例如指示模型采用特定角色或设定对话的基调（例如，“这是关于烹饪的对话”）。 
**HumanMessage** -- 用于用户输入中的内容。  
**AIMessage** -- 用于模型响应中的内容  
**Multimodality** -- 有关多模态内容的更多信息。 

5. 消息包含的数据
**id**:消息的可选唯一标识符。  
**name**: 一个可选的名称属性，允许区分具有相同角色的不同实体/说话者。并非所有模型都支持此功能！  
**metadata** :有关消息的其他信息，例如时间戳、令牌使用情况等。  
**tool calls** :模型发出的调用一个或多个工具的请求> 有关详细信息  
6. 对话结构
经典的对话结果一般为 user,ai,user,ai即一问一答
7. 聊天记录 （chat history ） 
<center><img src="md-image/img_4.png"></center>
由于聊天模型对输入大小有最大限制，因此管理聊天历史记录并根据需要修剪它以避免超出上下文窗口非常重要。（最近新起的contex engineer上下文管理工程）  
处理的过程中保持上图的结构很重要  

<div>
<a  href="https://langchain-ai.github.io/langgraph/concepts/memory/?_gl=1*mm3qhz*_gcl_au*MTM5NTQ0MjQxNS4xNzU2MTk1MDE4*_ga*MTU2MzEyNzY3My4xNzU2MjY0NTYx*_ga_47WX3HKKY2*czE3NTY0NTY0NTYkbzEzJGcxJHQxNzU2NDU4NjE3JGo2MCRsMCRoMA.." target="_blank"> 
怎么管理好记录，内存,上下文还需要进一步的学习，暂时未仔细学习 （最近也新起了 上下文管理工程）
</a>
</div>

<a href="https://python.langchain.com/docs/how_to/trim_messages/" target="_blank">裁剪消息</a>
<a href="https://langchain-ai.github.io/langgraph/how-tos/memory/add-memory/" target="_blank">添加和管理消息</a>

8. 消息类型：  
StstemMessage:对应系统角色
HumanMessage:对应用户角色
AiMessage:对应助理角色
AimessageChunk:对应助手角色，用于流式响应，支持`+`
ToolMessage:对应工具角色,有AiMessage的属性外还有tool_call_id

 *AIMessage具有的属性：
- content：内容
- tool_calls:工具调用详细信息
- invalid_tool_calls：工具调用失败详细信息
- usage_metadata ：使用元素据统计，比如token等
- id:消息唯一标识符,id的优先级：模型提供程序>langchain提供的（以run-开头）>自己创建的
- response_metadata：效应元数据

8. MessagesPlaceholder  消息占位符
```python
prompt_template = ChatPromptTemplate([
    ("system", "You are a helpful assistant"),
    MessagesPlaceholder("msgs")
])
# 需要转换成标准的模板格式
prompt_template.invoke({"msgs": [HumanMessage(content="hi!")]})
# 构建历史消息
messages_to_pass = [
    HumanMessage(content="What's the capital of France?"),
    AIMessage(content="The capital of France is Paris."),
    HumanMessage(content="And what about Germany?")
]
# 填充消息
formatted_prompt = prompt_template.invoke({"msgs": messages_to_pass})
print(formatted_prompt)
```

9. 多模态数据，不同模型使用不同的格式
10. 消息id的优先级：程序提供的（模型提供的）->langchain自动分配的->用户设置的
11. 当手动创建消息以及无运行管理上下文时（）